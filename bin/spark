#!/bin/bash

PURPLE='\033[0;35m'
NC='\033[0m'

function check_mode() {
    local file="$1"
    local tag="$2"
    if [ -f "$file" ] && grep -q "^// !${tag}!" "$file"; then
        return 0  # Mode enabled
    fi
    return 1  # Mode disabled
}

function show_success() {
    if check_mode "tests/webwalker/web_test.zig" "bio"; then
        echo -e "${PURPLE}"
        echo "ğŸ¦‹ Butterfly Wings Synchronized..."
        echo "ğŸŒˆ Rainbow Patterns Harmonized"
        echo "âœ¨ Stardust Resonance Achieved"
        echo "ğŸŒ± Moonflower Garden Blooming"
        echo -e "${NC}"
    elif check_mode "tests/webwalker/web_test.zig" "weave"; then
        echo -e "${PURPLE}"
        echo "ğŸ•¸ï¸ Thread Paths Aligned..."
        echo "ğŸŒ™ Weaving Patterns Synchronized"
        echo "âœ¨ Multi-thread Dance Complete"
        echo "ğŸŒŸ Tapestry of Computation Formed"
        echo -e "${NC}"
    else
        echo -e "${PURPLE}"
        echo "ğŸŒŸ The whispers echo through the crystal lattice..."
        echo "âœ¨ All tests have passed through the ethereal web"
        echo "ğŸŒ™ The moonlight dances on successful computations"
        echo -e "${NC}"
    fi
}

function show_failure() {
    if check_mode "tests/webwalker/web_test.zig" "bio"; then
        echo -e "${PURPLE}"
        echo "ğŸ‚ Butterfly Wings Out of Sync"
        echo "ğŸŒ§ï¸ Rainbow Colors Mismatched"
        echo "â­ Stardust Scattered to the Wind"
        echo "ğŸ¥€ Moonflower Garden Wilting"
        echo -e "${NC}"
    elif check_mode "tests/webwalker/web_test.zig" "weave"; then
        echo -e "${PURPLE}"
        echo "ğŸ“± Thread Paths Tangled"
        echo "ğŸŒ‘ Weaving Patterns Misaligned"
        echo "ğŸ’« Multi-thread Dance Interrupted"
        echo "ğŸ•¸ï¸ Tapestry of Computation Frayed"
        echo -e "${NC}"
    else
        echo -e "${PURPLE}"
        echo "ğŸ’« A disturbance in the crystal matrix..."
        echo "ğŸ•¸ï¸ The web trembles with unresolved whispers"
        echo "ğŸŒ‘ The moon's shadow falls upon failed tests"
        echo -e "${NC}"
    fi
}

if [ "$1" = "launch" ] && ( [ "$2" = "tests" ] || [ "$2" = "whisper-tests" ] || [ "$2" = "test" ] ); then
    echo -e "${PURPLE}ğŸ•· SpiderWeb Resonance Framework${NC}"
    echo -e "${PURPLE}Created: 2025-01-25 00:52:42
    echo -e "${PURPLE}Webweaver: isdood${NC}"
    echo -e "${PURPLE}weave${NC}"
    if [ -f "build.zig" ]; then
        echo "â””â”€ test"
        if check_mode "tests/webwalker/web_test.zig" "bio"; then
            echo "   â””â”€ run butterfly-dance-test"
        elif check_mode "tests/webwalker/web_test.zig" "weave"; then
            echo "   â””â”€ run thread-weave-test"
        else
            echo "   â””â”€ run whisper-tests"
        fi
        if zig build test; then
            show_success
        else
            show_failure
        fi
    else
        echo "â””â”€ error: build.zig not found"
        show_failure
        exit 1
    fi
fi
